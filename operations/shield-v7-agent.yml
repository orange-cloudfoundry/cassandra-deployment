---

- path: /releases/name=shield?
  type: replace
  value:
    name: shield
    version: "7.0.4"
    url: https://github.com/gstackio/gk-shield-boshrelease/releases/download/v7.0.4/shield-7.0.4.tgz
    sha1: 6dd6acb2da7d5c451b53bca15d0ec5a8e767fa3c


- path: /instance_groups/name=cassandra-seeds/jobs/name=shield-agent?
  type: replace
  value: &shield_agent_job
    name: shield-agent
    release: shield
    consumes:
      shield-daemon: { from: shield-daemon, deployment: shield }
    properties:
      autoprovision: true
      targets:
        ((cassandra_keyspace))-keyspace:
          name: (deployment)/(name)-(index)/((cassandra_keyspace))-keyspace
          plugin: cassandra
          config:
            cassandra_host: (ip)
            cassandra_password: ((cassandra_admin_password))
            cassandra_keyspace: ((cassandra_keyspace))
            cassandra_bindir: /var/vcap/jobs/cassandra/bin
            cassandra_datadir: /var/vcap/store/cassandra/((deployment_name))/data
      jobs:
        example-sys-ks_hourly2fs:
          name: (deployment)/(name)-(index)/((cassandra_keyspace))/hourly2fs
          schedule: hourly
          target: (deployment)/(name)-(index)/((cassandra_keyspace))-keyspace
          store: test-fs-store
          retention: week
      stores:
        name: test-fs-store
        plugin: fs
        config:
          base_dir: /var/vcap/store/shield-backups
      schedules:
        hourly: hourly at 30
      retention-policies:
        week: 7d

- path: /instance_groups/name=cassandra-servers/jobs/name=shield-agent?
  type: replace
  value: *shield_agent_job
